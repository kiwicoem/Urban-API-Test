//Basic Public API Tests in Javascript
//Get a random joke
//Written in Javascript

//Basic joke query structure
async function getRandomJoke(){
  try{
    const response = await fetch(https://official-joke-api.appspot.com/random_joke);
    const joke = await response.json();
    console.log(`${joke.setup}`);
    console.log(`${joke.punchline}`);
    console.log(`${joke.type}`);
    console.log(`${joke.id}`);
  }
  catch(error){
    console.error('API access failed:', error);
  }

//Performance Test function
//Queries X amount of random jokes, then logs average, highest, and lowest response time
async performanceTest(requests){
  console.log('\n\nRunning performance test with ${requests} requests\n\n');

  const times = [];
  let errors = 0;

  for(let i = 0; i < requests; i++){
    const startTime = Date.now();
    try{
      await this.getRandomJoke();
      const endTime = Date.now();
      times.push(endTime - startTime);
    }
    catch (error){
      error++;
    }
  }

    console.log('Performance Test Results:\n');

    if(times.length > 0){
      maxTime = Math.max(times);
      minTime = Math.min(times);

      let total = 0;
      for(j = 0, j<times.length; j++){
        total +=times[j];
      }
      avgTime = (total/times.length);
    }

    console.log('Average Response time is ${avgTime} milliseconds\n');
    console.log('Lowest Response time is ${minTime} milliseconds\n');
    console.log('Highest Response time is ${maxTime} milliseconds\n\n');

    if(errors > 0){
      let errorRate = (errors/requests)*100
    }
    console.log('Total Error count is ${errors}\n');
    console.log('Error Percentage is ${errorRate}\n');
  
}

//Main function
//Run a basic performance test and output the results
async function main(){
  console.log('Welcome to the Random Joke Generator Public API Performance Test program.\n');
  const userRequests = prompt('Please enter the number of queries to be run: ');

  performanceTest(userRequests);
}
